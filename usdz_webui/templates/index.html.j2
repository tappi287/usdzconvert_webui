{% extends "base.html.j2" %}
{% block title %}Index{% endblock %}
{% block head %}
    {{ super() }}
    <script type="text/javascript">var upload_allowed_ext = {{ upload_allowed_ext|tojson }}</script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/texture_maps.js') }}"></script>
{% endblock %}

{% block page_title %}
    {{ content.title }}
{% endblock %}

{% block description %}
    <p>Drag n drop files to the appropiate upload fields. You need to manually assign texture maps. They will not be read from the input file.
     Submit will enqueue a conversion job and guide you to the job page.</p>
{% endblock %}

{% block content %}
    <form method="post" action="/" enctype="multipart/form-data" class="montform" id="reused_form">
        <div class="file">
            <label>
                {{ content.job_form.scene_file_field.label }}
                <input name="{{ content.job_form.scene_file_field.id }}" type="file" required class="feedback-input file-field">
            </label>
            <span class="description">{{ content.job_form.scene_file_field.desc|e }}</span>
        </div>
        <br />

        <div id="dropzone">
            <p id="drop_text" class="description">Drag n drop texture maps here</p>
            <div id="texture-map-container"></div>
        </div>
        <br />

        <details id="options">
            <summary>Options</summary>
            {% for option_field in content.job_form.option_fields %}
                <div class="file">
                    <label>
                        {{ option_field.label }}
                        {% if option_field.input_type == 'textarea' %}
                            <input name="{{ option_field.id }}" type="text" class="color-channel">
                        {% elif option_field.input_type == 'checkbox' %}
                            <div class="checkbox-container">
                                <input name="{{ option_field.id }}" type="checkbox">
                                <span class="checkmark"></span>
                            </div>
                        {% elif option_field.input_type == 'float' %}
                            <input name="{{ option_field.id }}" type="number" step="any"  min="0" class="color-channel">
                        {% elif option_field.input_type == 'url' %}
                            <input name="{{ option_field.id }}" type="url" class="color-channel">
                        {% endif %}
                        <br />
                    </label>
                    <span class="description">{{ option_field.desc|e }}</span>
                </div>
            {% endfor %}
            <p class="file">
                 <textarea name="{{ content.job_form.additional_args }}" class="feedback-input" id="commands" 
                 placeholder="{{ content.job_form.additional_args_text }}"></textarea>
            </p>
        </details>

        <br />
         <div class="submit">
             <button type="submit" class="button-blue">SUBMIT</button>
             <div class="ease"></div>
         </div>
    </form>

    <div style="display: none;">
        <div id="texture-form-template" class="texture-map-entry" style="display: none">
            <span class="texture_file_label"></span>
            <input style="display: none;" name="template_file" type="text" class="texture_file_name">
            <label>
                Map Type
                <select name="texture_type" class="texture_type">
                    {% for texture_map in content.job_form.file_fields %}
                        <option value="{{ texture_map.label }}" description="{{ texture_map.desc }}">{{ texture_map.label }}</option>
                    {% endfor %}
                </select>
            </label>
            <label>
                Channel
                <select name="texture_channel" class="texture_channel">
                    <option value="">RGBA</option>
                    <option value="R">R</option>
                    <option value="G">G</option>
                    <option value="B">B</option>
                    <option value="A">A</option>
                </select>
                <!-- <input name="texture_channel" type="text" list="color-channels" class="color-channel drop-texture-channel"> -->
            </label>
            <label>
                Material
                <input name="material" type="text" class="texture_material">
            </label>
            <span class="description">Texture Type Description</span>
        </div>
    </div>
{% endblock content %}
